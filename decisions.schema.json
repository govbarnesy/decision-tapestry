{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Decision Tapestry Schema",
  "description": "Schema for Decision Tapestry YAML files. This validates the structure of backlog items and decisions.",
  "type": "object",
  "properties": {
    "backlog": {
      "type": "array",
      "description": "Array of backlog items (ideas, features, or decisions being considered)",
      "items": {
        "type": "object",
        "properties": {
          "id": { 
            "type": "integer",
            "description": "Unique identifier for the backlog item"
          },
          "title": { 
            "type": "string",
            "description": "Brief title describing the backlog item"
          },
          "author": { 
            "type": "string",
            "description": "Person who created this backlog item"
          },
          "created": { 
            "type": "string", 
            "format": "date-time",
            "description": "ISO 8601 timestamp when the item was created"
          },
          "status": { 
            "type": "string", 
            "enum": ["Open", "In Progress", "Blocked"],
            "description": "Current status of the backlog item"
          },
          "rationale": { 
            "type": "array", 
            "items": { "type": "string" },
            "description": "List of reasons why this item is important"
          },
          "tradeoffs": { 
            "type": "array", 
            "items": { "type": "string" },
            "description": "List of considerations or compromises involved"
          },
          "tasks": {
            "type": "array",
            "description": "Specific implementation tasks for this backlog item",
            "items": {
              "type": "object",
              "properties": {
                "description": { "type": "string" },
                "status": { "type": "string", "enum": ["Pending", "In Progress", "Completed", "Done", "Blocked"] }
              },
              "required": ["description"]
            }
          },
          "category": {
            "type": "string",
            "enum": ["Infrastructure", "Developer Experience", "UI/UX", "Architecture", "Process", "Quality", "Integration", "Other"],
            "description": "Category for clustering and navigation purposes"
          },
          "notes": { 
            "type": "string",
            "description": "Additional notes or context"
          }
        },
        "required": ["id", "title", "status"]
      }
    },
    "decisions": {
      "type": "array", 
      "description": "Array of finalized decisions that have been made",
      "items": {
        "type": "object",
        "properties": {
          "id": { 
            "type": "integer",
            "description": "Unique identifier for the decision"
          },
          "title": { 
            "type": "string",
            "description": "Brief title describing the decision"
          },
          "author": { 
            "oneOf": [
              {
                "type": "string",
                "description": "Plain text author name (legacy format)"
              },
              {
                "type": "object",
                "description": "GitHub user object with enhanced metadata",
                "properties": {
                  "github_username": {
                    "type": "string",
                    "description": "GitHub username"
                  },
                  "display_name": {
                    "type": "string",
                    "description": "Display name for the user"
                  },
                  "avatar_url": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to user's GitHub avatar"
                  },
                  "profile_url": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to user's GitHub profile"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User's email address (if available)"
                  }
                },
                "required": ["github_username", "display_name"],
                "additionalProperties": false
              }
            ],
            "description": "Person who made or documented this decision (string or GitHub user object)"
          },
          "date": { 
            "oneOf": [
              {
                "type": "string", 
                "format": "date-time",
                "description": "ISO 8601 timestamp when the decision was made (manual entry)"
              },
              {
                "type": "object",
                "description": "Enhanced date object with Git metadata",
                "properties": {
                  "decision_date": {
                    "type": "string",
                    "format": "date-time",
                    "description": "When the decision was made"
                  },
                  "first_commit_date": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Date of first commit implementing this decision"
                  },
                  "last_commit_date": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Date of most recent commit related to this decision"
                  },
                  "git_derived": {
                    "type": "boolean",
                    "description": "Whether dates were derived from Git history"
                  },
                  "commit_count": {
                    "type": "integer",
                    "description": "Number of commits related to this decision"
                  }
                },
                "required": ["decision_date"],
                "additionalProperties": false
              }
            ],
            "description": "When the decision was made (string or enhanced date object)"
          },
          "status": { 
            "type": "string", 
            "enum": ["Accepted", "Superseded", "Rejected", "Proposed", "Done", "Completed", "Pending"],
            "description": "Current status of the decision"
          },
          "project": { 
            "type": "string",
            "description": "Project or component this decision relates to"
          },
          "rationale": { 
            "type": "array", 
            "items": { "type": "string" },
            "description": "List of reasons why this decision was made"
          },
          "tradeoffs": { 
            "type": "array", 
            "items": { "type": "string" },
            "description": "List of tradeoffs or compromises in this decision"
          },
          "related_to": { 
            "type": "array", 
            "items": { "type": "integer" },
            "description": "IDs of related decisions"
          },
          "supersedes": { 
            "type": ["integer", "null"],
            "description": "ID of the decision this one replaces (if any)"
          },
          "superseded_by": { 
            "type": ["integer", "null"],
            "description": "ID of the decision that replaces this one (if any)"
          },
          "affected_components": { 
            "type": "array", 
            "items": { "type": "string" },
            "description": "List of files, modules, or components affected by this decision"
          },
          "tasks": {
            "type": "array",
            "description": "Implementation tasks for this decision",
            "items": {
              "type": "object",
              "properties": {
                "description": { "type": "string" },
                "status": { "type": "string", "enum": ["Pending", "In Progress", "Completed", "Done", "Blocked"] }
              },
              "required": ["description"]
            }
          },
          "category": {
            "type": "string",
            "enum": ["Infrastructure", "Developer Experience", "UI/UX", "Architecture", "Process", "Quality", "Integration", "Other"],
            "description": "Category for clustering and navigation purposes"
          },
          "notes": { 
            "type": "string",
            "description": "Additional notes or context about this decision"
          },
          "github_metadata": {
            "type": "object",
            "description": "GitHub-specific metadata for this decision",
            "properties": {
              "repository": {
                "type": "string",
                "description": "GitHub repository (owner/repo format)"
              },
              "pull_requests": {
                "type": "array",
                "description": "Related GitHub pull requests",
                "items": {
                  "type": "object",
                  "properties": {
                    "number": { "type": "integer" },
                    "title": { "type": "string" },
                    "url": { "type": "string", "format": "uri" },
                    "status": { "type": "string", "enum": ["open", "closed", "merged"] }
                  },
                  "required": ["number", "title", "url", "status"]
                }
              },
              "issues": {
                "type": "array",
                "description": "Related GitHub issues",
                "items": {
                  "type": "object",
                  "properties": {
                    "number": { "type": "integer" },
                    "title": { "type": "string" },
                    "url": { "type": "string", "format": "uri" },
                    "status": { "type": "string", "enum": ["open", "closed"] }
                  },
                  "required": ["number", "title", "url", "status"]
                }
              },
              "commits": {
                "type": "array",
                "description": "Key commits implementing this decision",
                "items": {
                  "type": "object",
                  "properties": {
                    "sha": { "type": "string" },
                    "message": { "type": "string" },
                    "url": { "type": "string", "format": "uri" },
                    "date": { "type": "string", "format": "date-time" },
                    "author": { "type": "string" }
                  },
                  "required": ["sha", "message", "url", "date"]
                }
              },
              "file_status": {
                "type": "object",
                "description": "Status of affected components in repository",
                "properties": {
                  "created": {
                    "type": "array",
                    "description": "Files created by this decision",
                    "items": { "type": "string" }
                  },
                  "modified": {
                    "type": "array",
                    "description": "Files modified by this decision",
                    "items": { "type": "string" }
                  },
                  "deleted": {
                    "type": "array",
                    "description": "Files deleted by this decision",
                    "items": { "type": "string" }
                  },
                  "missing": {
                    "type": "array",
                    "description": "Files that no longer exist in repository",
                    "items": { "type": "string" }
                  }
                }
              }
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "title", "status"]
      }
    }
  },
  "required": ["decisions"],
  "additionalProperties": false
} 